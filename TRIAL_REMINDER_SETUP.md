# üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ Trial

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

‚úÖ **Backend —Ñ—É–Ω–∫—Ü–∏—è**: `trial-reminder` –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞  
‚úÖ **URL**: https://functions.poehali.dev/2c1becc4-590e-48a4-a712-3efc4e707169  
‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –¢–∞–±–ª–∏—Ü–∞ `notifications` —Å–æ–∑–¥–∞–Ω–∞  
‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏—è**: –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `trial_reminder_sent`  

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ö–∞–∂–¥—ã–π —á–∞—Å** —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å Trial
2. –ï—Å–ª–∏ –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è Trial **–æ—Å—Ç–∞–ª–æ—Å—å 12 —á–∞—Å–æ–≤** ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `notifications`
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
5. –§–ª–∞–≥ `trial_reminder_sent = true` ‚Üí –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥—É–±–ª–∏

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: Yandex Cloud Triggers (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ó–∞–π–¥–∏—Ç–µ –≤ [Yandex Cloud Console](https://console.cloud.yandex.ru/)
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç **StudyFay**
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Cloud Functions ‚Üí Triggers**
4. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä**
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
   - **–¢–∏–ø**: –¢–∞–π–º–µ—Ä (Cron)
   - **Cron-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ**: `0 * * * *` (–∫–∞–∂–¥—ã–π —á–∞—Å)
   - **–§—É–Ω–∫—Ü–∏—è**: `trial-reminder`
   - **–ú–µ—Ç–æ–¥**: POST
   - **Payload**: `{}`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í–Ω–µ—à–Ω–∏–π cron-—Å–µ—Ä–≤–∏—Å (easycron.com, cron-job.org)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [cron-job.org](https://cron-job.org)
2. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞–Ω–∏–µ:
   - **URL**: https://functions.poehali.dev/2c1becc4-590e-48a4-a712-3efc4e707169
   - **–ú–µ—Ç–æ–¥**: POST
   - **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –ö–∞–∂–¥—ã–π —á–∞—Å (`0 * * * *`)
   - **Headers**: `Content-Type: application/json`

### –í–∞—Ä–∏–∞–Ω—Ç 3: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ç–µ—Å—Ç–∞)

```bash
curl -X POST https://functions.poehali.dev/2c1becc4-590e-48a4-a712-3efc4e707169
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```json
{
  "user_id": 15,
  "title": "‚è∞ Trial –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è!",
  "message": "–û—Å—Ç–∞–ª–æ—Å—å 12 —á–∞—Å–æ–≤ Premium –¥–æ—Å—Ç—É–ø–∞. –£—Å–ø–µ–π—Ç–µ –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É —Å–æ —Å–∫–∏–¥–∫–æ–π 33%!",
  "action_url": "/subscription",
  "is_read": false,
  "created_at": "2026-02-05T10:00:00"
}
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å Trial:
```sql
SELECT id, email, trial_ends_at, trial_reminder_sent 
FROM users 
WHERE trial_ends_at > NOW() 
  AND is_trial_used = false;
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
```sql
SELECT n.*, u.email 
FROM notifications n 
JOIN users u ON n.user_id = u.id 
WHERE n.title LIKE '%Trial%' 
ORDER BY n.created_at DESC;
```

### 3. –°–±—Ä–æ—Å–∏—Ç—å —Ñ–ª–∞–≥ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:
```sql
UPDATE users 
SET trial_reminder_sent = false 
WHERE id = 15;
```

---

## –ü—Ä–æ–≥–Ω–æ–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–ë–µ–∑ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π**: 30% –∫–æ–Ω–≤–µ—Ä—Å–∏—è Trial ‚Üí Premium  
**–° –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏**: 35-40% –∫–æ–Ω–≤–µ—Ä—Å–∏—è  

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞:**
- 100 Trial –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–º–µ—Å—è—Ü
- +5% –∫–æ–Ω–≤–µ—Ä—Å–∏—è = +5 –ø–æ–∫—É–ø–æ–∫
- –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ 1200‚ÇΩ
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤—ã—Ä—É—á–∫–∞: +6000‚ÇΩ/–º–µ—Å—è—Ü**

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ —Ñ—É–Ω–∫—Ü–∏–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—É—Å–∫–∏
curl https://functions.poehali.dev/2c1becc4-590e-48a4-a712-3efc4e707169
```

### –û—Ç–≤–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏:
```json
{
  "notifications_sent": 2,
  "users": [
    {"user_id": 15, "email": "user@mail.ru", ...},
    {"user_id": 16, "email": "test@mail.ru", ...}
  ]
}
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron-—Ç—Ä–∏–≥–≥–µ—Ä (–≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã—à–µ)
2. –î–æ–±–∞–≤–∏—Ç—å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Firebase (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. –î–æ–±–∞–≤–∏—Ç—å email-–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å A/B —Ç–µ—Å—Ç —Ç–µ–∫—Å—Ç–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
