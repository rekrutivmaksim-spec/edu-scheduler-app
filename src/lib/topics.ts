export const TOPICS_BY_SUBJECT: Record<string, string[]> = {
  'Математика (профиль)': [
    'Квадратные уравнения', 'Производная функции', 'Интегралы',
    'Логарифмы', 'Тригонометрия', 'Пределы', 'Матрицы и определители',
  ],
  'Математика (база)': [
    'Квадратные уравнения', 'Дроби и проценты', 'Линейные функции',
    'Геометрия: площади',
  ],
  'Математика': [
    'Квадратные уравнения', 'Производная функции',
    'Логарифмы', 'Тригонометрия',
  ],
  'Физика': [
    'Законы Ньютона', 'Электрическое поле',
    'Магнетизм', 'Оптика', 'Термодинамика',
  ],
  'Химия': [
    'Реакции окисления-восстановления', 'Органические соединения',
    'Периодическая система', 'Кислоты и основания',
  ],
  'Биология': [
    'Клеточное строение', 'Генетика и наследственность',
    'Эволюция', 'Экология',
  ],
  'Информатика': [
    'Алгоритмы сортировки', 'Рекурсия',
    'Логические операции', 'Базы данных',
  ],
  'История': [
    'Петровские реформы', 'Вторая мировая война',
    'Революция 1917 года', 'Эпоха Ивана Грозного',
  ],
  'Русский язык': [
    'Причастие и деепричастие', 'Сложноподчинённые предложения',
    'Орфография: корни с чередованием', 'Пунктуация',
  ],
  'Обществознание': [
    'Конституция РФ', 'Рыночная экономика',
    'Права человека', 'Политические системы',
  ],
  'Литература': [
    'Война и мир: образы', 'Мастер и Маргарита',
    'Лирика Пушкина', 'Преступление и наказание',
  ],
  'Английский язык': [
    'Present Perfect vs Past Simple', 'Условные предложения',
    'Пассивный залог', 'Артикли',
  ],
  'География': [
    'Климатические пояса', 'Природные зоны России',
    'Экономические районы', 'Демография',
  ],
};

export const DEFAULT_TOPICS = [
  { subject: 'Математика', topic: 'Квадратные уравнения' },
  { subject: 'Русский язык', topic: 'Причастие и деепричастие' },
  { subject: 'Физика', topic: 'Законы Ньютона' },
  { subject: 'Химия', topic: 'Реакции окисления-восстановления' },
  { subject: 'История', topic: 'Петровские реформы' },
  { subject: 'Обществознание', topic: 'Конституция РФ' },
];

export function simpleHash(str: string): number {
  let h = 0;
  for (let i = 0; i < str.length; i++) {
    h = (Math.imul(31, h) + str.charCodeAt(i)) | 0;
  }
  return Math.abs(h);
}

export function getTodayTopic(examSubject?: string | null): { subject: string; topic: string } {
  const today = new Date().toISOString().slice(0, 10);
  const hash = simpleHash(today);
  if (examSubject && TOPICS_BY_SUBJECT[examSubject]) {
    const topics = TOPICS_BY_SUBJECT[examSubject];
    return { subject: examSubject, topic: topics[hash % topics.length] };
  }
  const fallback = DEFAULT_TOPICS[hash % DEFAULT_TOPICS.length];
  return { subject: fallback.subject, topic: fallback.topic };
}
